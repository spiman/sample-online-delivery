{"/Users/spyros/workspace/desquared-online-delivery/src/datasource/cart.ts":{"path":"/Users/spyros/workspace/desquared-online-delivery/src/datasource/cart.ts","statementMap":{"0":{"start":{"line":2,"column":16},"end":{"line":10,"column":1}},"1":{"start":{"line":3,"column":28},"end":{"line":3,"column":110}},"2":{"start":{"line":3,"column":91},"end":{"line":3,"column":106}},"3":{"start":{"line":4,"column":4},"end":{"line":9,"column":7}},"4":{"start":{"line":5,"column":36},"end":{"line":5,"column":97}},"5":{"start":{"line":5,"column":42},"end":{"line":5,"column":70}},"6":{"start":{"line":5,"column":85},"end":{"line":5,"column":95}},"7":{"start":{"line":6,"column":35},"end":{"line":6,"column":100}},"8":{"start":{"line":6,"column":41},"end":{"line":6,"column":73}},"9":{"start":{"line":6,"column":88},"end":{"line":6,"column":98}},"10":{"start":{"line":7,"column":32},"end":{"line":7,"column":116}},"11":{"start":{"line":8,"column":8},"end":{"line":8,"column":78}},"12":{"start":{"line":11,"column":0},"end":{"line":11,"column":62}},"13":{"start":{"line":12,"column":19},"end":{"line":12,"column":38}},"14":{"start":{"line":13,"column":23},"end":{"line":17,"column":2}},"15":{"start":{"line":18,"column":19},"end":{"line":20,"column":2}},"16":{"start":{"line":21,"column":0},"end":{"line":21,"column":57}},"17":{"start":{"line":23,"column":4},"end":{"line":25,"column":7}},"18":{"start":{"line":24,"column":8},"end":{"line":24,"column":46}},"19":{"start":{"line":27,"column":0},"end":{"line":27,"column":32}},"20":{"start":{"line":29,"column":4},"end":{"line":34,"column":7}},"21":{"start":{"line":30,"column":8},"end":{"line":32,"column":9}},"22":{"start":{"line":31,"column":12},"end":{"line":31,"column":50}},"23":{"start":{"line":33,"column":8},"end":{"line":33,"column":58}},"24":{"start":{"line":36,"column":0},"end":{"line":36,"column":26}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":2,"column":44},"end":{"line":2,"column":45}},"loc":{"start":{"line":2,"column":89},"end":{"line":10,"column":1}},"line":2},"1":{"name":"adopt","decl":{"start":{"line":3,"column":13},"end":{"line":3,"column":18}},"loc":{"start":{"line":3,"column":26},"end":{"line":3,"column":112}},"line":3},"2":{"name":"(anonymous_2)","decl":{"start":{"line":3,"column":70},"end":{"line":3,"column":71}},"loc":{"start":{"line":3,"column":89},"end":{"line":3,"column":108}},"line":3},"3":{"name":"(anonymous_3)","decl":{"start":{"line":4,"column":36},"end":{"line":4,"column":37}},"loc":{"start":{"line":4,"column":63},"end":{"line":9,"column":5}},"line":4},"4":{"name":"fulfilled","decl":{"start":{"line":5,"column":17},"end":{"line":5,"column":26}},"loc":{"start":{"line":5,"column":34},"end":{"line":5,"column":99}},"line":5},"5":{"name":"rejected","decl":{"start":{"line":6,"column":17},"end":{"line":6,"column":25}},"loc":{"start":{"line":6,"column":33},"end":{"line":6,"column":102}},"line":6},"6":{"name":"step","decl":{"start":{"line":7,"column":17},"end":{"line":7,"column":21}},"loc":{"start":{"line":7,"column":30},"end":{"line":7,"column":118}},"line":7},"7":{"name":"createCart","decl":{"start":{"line":22,"column":9},"end":{"line":22,"column":19}},"loc":{"start":{"line":22,"column":22},"end":{"line":26,"column":1}},"line":22},"8":{"name":"(anonymous_8)","decl":{"start":{"line":23,"column":43},"end":{"line":23,"column":44}},"loc":{"start":{"line":23,"column":56},"end":{"line":25,"column":5}},"line":23},"9":{"name":"getCart","decl":{"start":{"line":28,"column":9},"end":{"line":28,"column":16}},"loc":{"start":{"line":28,"column":21},"end":{"line":35,"column":1}},"line":28},"10":{"name":"(anonymous_10)","decl":{"start":{"line":29,"column":43},"end":{"line":29,"column":44}},"loc":{"start":{"line":29,"column":56},"end":{"line":34,"column":5}},"line":29}},"branchMap":{"0":{"loc":{"start":{"line":2,"column":16},"end":{"line":10,"column":1}},"type":"binary-expr","locations":[{"start":{"line":2,"column":17},"end":{"line":2,"column":21}},{"start":{"line":2,"column":25},"end":{"line":2,"column":39}},{"start":{"line":2,"column":44},"end":{"line":10,"column":1}}],"line":2},"1":{"loc":{"start":{"line":3,"column":35},"end":{"line":3,"column":109}},"type":"cond-expr","locations":[{"start":{"line":3,"column":56},"end":{"line":3,"column":61}},{"start":{"line":3,"column":64},"end":{"line":3,"column":109}}],"line":3},"2":{"loc":{"start":{"line":4,"column":16},"end":{"line":4,"column":34}},"type":"binary-expr","locations":[{"start":{"line":4,"column":16},"end":{"line":4,"column":17}},{"start":{"line":4,"column":22},"end":{"line":4,"column":33}}],"line":4},"3":{"loc":{"start":{"line":7,"column":32},"end":{"line":7,"column":115}},"type":"cond-expr","locations":[{"start":{"line":7,"column":46},"end":{"line":7,"column":67}},{"start":{"line":7,"column":70},"end":{"line":7,"column":115}}],"line":7},"4":{"loc":{"start":{"line":8,"column":51},"end":{"line":8,"column":67}},"type":"binary-expr","locations":[{"start":{"line":8,"column":51},"end":{"line":8,"column":61}},{"start":{"line":8,"column":65},"end":{"line":8,"column":67}}],"line":8},"5":{"loc":{"start":{"line":30,"column":8},"end":{"line":32,"column":9}},"type":"if","locations":[{"start":{"line":30,"column":8},"end":{"line":32,"column":9}},{"start":{"line":30,"column":8},"end":{"line":32,"column":9}}],"line":30}},"s":{"0":1,"1":0,"2":0,"3":3,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":2,"11":3,"12":1,"13":1,"14":1,"15":1,"16":1,"17":1,"18":1,"19":1,"20":2,"21":2,"22":1,"23":1,"24":1},"f":{"0":3,"1":0,"2":0,"3":3,"4":0,"5":0,"6":2,"7":1,"8":1,"9":2,"10":2},"b":{"0":[1,1,1],"1":[0,0],"2":[3,3],"3":[2,0],"4":[3,3],"5":[1,1]},"inputSourceMap":{"version":3,"file":"/Users/spyros/workspace/desquared-online-delivery/src/datasource/cart.ts","sources":["/Users/spyros/workspace/desquared-online-delivery/src/datasource/cart.ts"],"names":[],"mappings":";;;;;;;;;;;AAAA,uCAAwE;AAExE,MAAM,cAAc,GAAG,IAAI,iBAAM,CAAC;IAC9B,MAAM,EAAE,EAAE,IAAI,EAAE,iBAAM,CAAC,KAAK,CAAC,QAAQ,EAAG,GAAG,EAAE,UAAU,EAAE;IACzD,QAAQ,EAAE,EAAE,IAAI,EAAE,MAAM,EAAE,GAAG,EAAE,CAAC,EAAE;IAClC,OAAO,EAAE,MAAM;CAClB,CAAC,CAAC;AAQH,MAAM,UAAU,GAAG,IAAI,iBAAM,CAAC;IAC1B,KAAK,EAAE,CAAC,cAAc,CAAC;CAC1B,CAAC,CAAC;AAMU,QAAA,SAAS,GAA4B,gBAAK,CAAe,MAAM,EAAE,UAAU,CAAC,CAAC;AAE1F,SAAsB,UAAU;;QAC5B,OAAO,IAAI,iBAAS,EAAE,CAAC,IAAI,EAAE,CAAA;IACjC,CAAC;CAAA;AAFD,gCAEC;AAED,SAAsB,OAAO,CAAC,EAAU;;QACpC,IAAI,gBAAK,CAAC,QAAQ,CAAC,OAAO,CAAC,EAAE,CAAC,EAAE;YAC5B,OAAO,iBAAS,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC;SACjC;QACD,MAAM,IAAI,gBAAK,CAAC,qBAAqB,CAAC,CAAC,CAAC,mBAAmB;IAC/D,CAAC;CAAA;AALD,0BAKC","sourcesContent":["import { Document, Error, Model, model, Schema, Types } from \"mongoose\";\n\nconst cartItemSchema = new Schema({\n    itemId: { type: Schema.Types.ObjectId , ref: 'MenuItem' },\n    quantity: { type: Number, min: 1 },\n    comment: String\n});\n\nexport type CartItemDocument = {\n    itemId: string,\n    quantity: number,\n    comment?: string\n};\n\nconst cartSchema = new Schema({\n    items: [cartItemSchema]\n});\n\nexport type CartDocument = Document & {\n    items: Array<any>\n};\n\nexport const MongoCart: Model<CartDocument, {}> = model<CartDocument>('Cart', cartSchema);\n\nexport async function createCart(): Promise<CartDocument> {\n    return new MongoCart().save()\n}\n\nexport async function getCart(id: string): Promise<CartDocument> {\n    if (Types.ObjectId.isValid(id)) {\n        return MongoCart.findById(id);\n    }\n    throw new Error(\"invalid id supplied\"); //should specialize\n}\n\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"6c18315a3873ef81d3c7af9c44f2a38d21cb76c8","contentHash":"827a946019111b68092154c4bbc0645d507a49f79941612a80fde70334a9b5ab"},"/Users/spyros/workspace/desquared-online-delivery/src/index.ts":{"path":"/Users/spyros/workspace/desquared-online-delivery/src/index.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":3,"column":16},"end":{"line":3,"column":34}},"2":{"start":{"line":4,"column":17},"end":{"line":4,"column":36}},"3":{"start":{"line":5,"column":15},"end":{"line":5,"column":31}},"4":{"start":{"line":6,"column":15},"end":{"line":6,"column":41}},"5":{"start":{"line":7,"column":15},"end":{"line":7,"column":41}},"6":{"start":{"line":8,"column":0},"end":{"line":8,"column":39}},"7":{"start":{"line":9,"column":12},"end":{"line":9,"column":21}},"8":{"start":{"line":10,"column":0},"end":{"line":10,"column":24}},"9":{"start":{"line":11,"column":0},"end":{"line":11,"column":34}},"10":{"start":{"line":12,"column":0},"end":{"line":18,"column":3}},"11":{"start":{"line":13,"column":4},"end":{"line":13,"column":37}},"12":{"start":{"line":14,"column":4},"end":{"line":14,"column":38}},"13":{"start":{"line":15,"column":4},"end":{"line":17,"column":7}},"14":{"start":{"line":16,"column":8},"end":{"line":16,"column":31}},"15":{"start":{"line":19,"column":0},"end":{"line":19,"column":22}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":12,"column":74},"end":{"line":12,"column":75}},"loc":{"start":{"line":12,"column":80},"end":{"line":18,"column":1}},"line":12},"1":{"name":"(anonymous_1)","decl":{"start":{"line":15,"column":21},"end":{"line":15,"column":22}},"loc":{"start":{"line":15,"column":27},"end":{"line":17,"column":5}},"line":15}},"branchMap":{},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1,"12":1,"13":1,"14":1,"15":1},"f":{"0":1,"1":1},"b":{},"inputSourceMap":{"version":3,"file":"/Users/spyros/workspace/desquared-online-delivery/src/index.ts","sources":["/Users/spyros/workspace/desquared-online-delivery/src/index.ts"],"names":[],"mappings":";;AAAA,mCAAmC;AACnC,qCAAqC;AACrC,gCAAgC;AAChC,0CAAyC;AACzC,0CAAyC;AAEzC,MAAM,CAAC,GAAG,EAAE,CAAC,IAAI,CAAC,mBAAmB,CAAC,CAAC;AAEvC,MAAM,GAAG,GAAG,OAAO,EAAE,CAAC;AAEtB,GAAG,CAAC,GAAG,CAAC,OAAO,CAAC,IAAI,EAAE,CAAC,CAAC;AACxB,GAAG,CAAC,GAAG,CAAC,OAAO,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC,CAAC;AAElC,QAAQ,CAAC,OAAO,CAAC,MAAM,CAAC,GAAG,CAAC,WAAW,CAAC,EAAE,EAAE,eAAe,EAAE,IAAI,EAAE,CAAC,CAAC,IAAI,CAAC,GAAG,EAAE;IAC7E,GAAG,CAAC,GAAG,CAAC,OAAO,EAAE,cAAU,CAAC,CAAA;IAC5B,GAAG,CAAC,GAAG,CAAC,QAAQ,EAAE,cAAU,CAAC,CAAA;IAC7B,GAAG,CAAC,MAAM,CAAC,IAAI,EAAE,GAAG,EAAE;QACpB,OAAO,CAAC,GAAG,CAAC,SAAS,CAAC,CAAA;IACxB,CAAC,CAAC,CAAC;AACL,CAAC,CAAC,CAAA;AAEF,kBAAe,GAAG,CAAC","sourcesContent":["import * as express from 'express';\nimport * as mongoose from \"mongoose\";\nimport * as config from 'nconf';\nimport menuRouter from './handlers/menu';\nimport cartRouter from './handlers/cart';\n\nconfig.env().file('./src/config.json');\n\nconst app = express();\n\napp.use(express.json());\napp.use(express.static('public'));\n\nmongoose.connect(config.get('mongo:uri'), { useNewUrlParser: true }).then(() => {\n  app.use('/menu', menuRouter)\n  app.use('/carts', cartRouter)\n  app.listen(3000, () => {\n    console.log('started')\n  });\n})\n\nexport default app;\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"f40c6fe0a5df392385413069ecfd8f0bb7c99464","contentHash":"f2b90c86679929733e45635e2c3c606e63a5bad5baed790cc8b3caabd5f0a01e"},"/Users/spyros/workspace/desquared-online-delivery/src/handlers/menu.ts":{"path":"/Users/spyros/workspace/desquared-online-delivery/src/handlers/menu.ts","statementMap":{"0":{"start":{"line":2,"column":16},"end":{"line":10,"column":1}},"1":{"start":{"line":3,"column":28},"end":{"line":3,"column":110}},"2":{"start":{"line":3,"column":91},"end":{"line":3,"column":106}},"3":{"start":{"line":4,"column":4},"end":{"line":9,"column":7}},"4":{"start":{"line":5,"column":36},"end":{"line":5,"column":97}},"5":{"start":{"line":5,"column":42},"end":{"line":5,"column":70}},"6":{"start":{"line":5,"column":85},"end":{"line":5,"column":95}},"7":{"start":{"line":6,"column":35},"end":{"line":6,"column":100}},"8":{"start":{"line":6,"column":41},"end":{"line":6,"column":73}},"9":{"start":{"line":6,"column":88},"end":{"line":6,"column":98}},"10":{"start":{"line":7,"column":32},"end":{"line":7,"column":116}},"11":{"start":{"line":8,"column":8},"end":{"line":8,"column":78}},"12":{"start":{"line":11,"column":0},"end":{"line":11,"column":62}},"13":{"start":{"line":12,"column":18},"end":{"line":12,"column":36}},"14":{"start":{"line":13,"column":15},"end":{"line":13,"column":44}},"15":{"start":{"line":14,"column":15},"end":{"line":14,"column":40}},"16":{"start":{"line":15,"column":19},"end":{"line":15,"column":48}},"17":{"start":{"line":16,"column":15},"end":{"line":16,"column":44}},"18":{"start":{"line":17,"column":15},"end":{"line":17,"column":33}},"19":{"start":{"line":18,"column":0},"end":{"line":33,"column":4}},"20":{"start":{"line":18,"column":30},"end":{"line":33,"column":2}},"21":{"start":{"line":20,"column":4},"end":{"line":26,"column":5}},"22":{"start":{"line":21,"column":8},"end":{"line":21,"column":65}},"23":{"start":{"line":24,"column":8},"end":{"line":24,"column":85}},"24":{"start":{"line":25,"column":8},"end":{"line":25,"column":15}},"25":{"start":{"line":27,"column":33},"end":{"line":27,"column":104}},"26":{"start":{"line":28,"column":21},"end":{"line":31,"column":28}},"27":{"start":{"line":29,"column":8},"end":{"line":29,"column":76}},"28":{"start":{"line":30,"column":8},"end":{"line":30,"column":19}},"29":{"start":{"line":32,"column":4},"end":{"line":32,"column":35}},"30":{"start":{"line":34,"column":0},"end":{"line":34,"column":25}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":2,"column":44},"end":{"line":2,"column":45}},"loc":{"start":{"line":2,"column":89},"end":{"line":10,"column":1}},"line":2},"1":{"name":"adopt","decl":{"start":{"line":3,"column":13},"end":{"line":3,"column":18}},"loc":{"start":{"line":3,"column":26},"end":{"line":3,"column":112}},"line":3},"2":{"name":"(anonymous_2)","decl":{"start":{"line":3,"column":70},"end":{"line":3,"column":71}},"loc":{"start":{"line":3,"column":89},"end":{"line":3,"column":108}},"line":3},"3":{"name":"(anonymous_3)","decl":{"start":{"line":4,"column":36},"end":{"line":4,"column":37}},"loc":{"start":{"line":4,"column":63},"end":{"line":9,"column":5}},"line":4},"4":{"name":"fulfilled","decl":{"start":{"line":5,"column":17},"end":{"line":5,"column":26}},"loc":{"start":{"line":5,"column":34},"end":{"line":5,"column":99}},"line":5},"5":{"name":"rejected","decl":{"start":{"line":6,"column":17},"end":{"line":6,"column":25}},"loc":{"start":{"line":6,"column":33},"end":{"line":6,"column":102}},"line":6},"6":{"name":"step","decl":{"start":{"line":7,"column":17},"end":{"line":7,"column":21}},"loc":{"start":{"line":7,"column":30},"end":{"line":7,"column":118}},"line":7},"7":{"name":"(anonymous_7)","decl":{"start":{"line":18,"column":16},"end":{"line":18,"column":17}},"loc":{"start":{"line":18,"column":30},"end":{"line":33,"column":2}},"line":18},"8":{"name":"(anonymous_8)","decl":{"start":{"line":18,"column":64},"end":{"line":18,"column":65}},"loc":{"start":{"line":18,"column":77},"end":{"line":33,"column":1}},"line":18},"9":{"name":"(anonymous_9)","decl":{"start":{"line":28,"column":33},"end":{"line":28,"column":34}},"loc":{"start":{"line":28,"column":46},"end":{"line":31,"column":5}},"line":28}},"branchMap":{"0":{"loc":{"start":{"line":2,"column":16},"end":{"line":10,"column":1}},"type":"binary-expr","locations":[{"start":{"line":2,"column":17},"end":{"line":2,"column":21}},{"start":{"line":2,"column":25},"end":{"line":2,"column":39}},{"start":{"line":2,"column":44},"end":{"line":10,"column":1}}],"line":2},"1":{"loc":{"start":{"line":3,"column":35},"end":{"line":3,"column":109}},"type":"cond-expr","locations":[{"start":{"line":3,"column":56},"end":{"line":3,"column":61}},{"start":{"line":3,"column":64},"end":{"line":3,"column":109}}],"line":3},"2":{"loc":{"start":{"line":4,"column":16},"end":{"line":4,"column":34}},"type":"binary-expr","locations":[{"start":{"line":4,"column":16},"end":{"line":4,"column":17}},{"start":{"line":4,"column":22},"end":{"line":4,"column":33}}],"line":4},"3":{"loc":{"start":{"line":7,"column":32},"end":{"line":7,"column":115}},"type":"cond-expr","locations":[{"start":{"line":7,"column":46},"end":{"line":7,"column":67}},{"start":{"line":7,"column":70},"end":{"line":7,"column":115}}],"line":7},"4":{"loc":{"start":{"line":8,"column":51},"end":{"line":8,"column":67}},"type":"binary-expr","locations":[{"start":{"line":8,"column":51},"end":{"line":8,"column":61}},{"start":{"line":8,"column":65},"end":{"line":8,"column":67}}],"line":8},"5":{"loc":{"start":{"line":21,"column":19},"end":{"line":21,"column":64}},"type":"binary-expr","locations":[{"start":{"line":21,"column":19},"end":{"line":21,"column":37}},{"start":{"line":21,"column":41},"end":{"line":21,"column":64}}],"line":21}},"s":{"0":1,"1":3,"2":0,"3":3,"4":3,"5":3,"6":0,"7":0,"8":0,"9":0,"10":6,"11":3,"12":1,"13":1,"14":1,"15":1,"16":1,"17":1,"18":1,"19":1,"20":3,"21":3,"22":3,"23":0,"24":0,"25":3,"26":3,"27":6,"28":6,"29":3,"30":1},"f":{"0":3,"1":3,"2":0,"3":3,"4":3,"5":0,"6":6,"7":3,"8":3,"9":6},"b":{"0":[1,1,1],"1":[3,0],"2":[3,3],"3":[3,3],"4":[3,3],"5":[3,2]},"inputSourceMap":{"version":3,"file":"/Users/spyros/workspace/desquared-online-delivery/src/handlers/menu.ts","sources":["/Users/spyros/workspace/desquared-online-delivery/src/handlers/menu.ts"],"names":[],"mappings":";;;;;;;;;;;AAAA,qCAAiC;AACjC,6CAA+D;AAC/D,yCAA8D;AAC9D,iDAA8C;AAC9C,6CAAqD;AAErD,MAAM,MAAM,GAAG,gBAAM,EAAE,CAAC;AACxB,MAAM,CAAC,GAAG,CAAC,GAAG,EAAE,CAAO,GAAG,EAAE,GAAG,EAAE,EAAE;IACjC,IAAI,QAAkB,CAAC;IACvB,IAAI;QACF,QAAQ,GAAG,GAAG,CAAC,KAAK,CAAC,QAAoB,IAAI,mBAAQ,CAAC,GAAG,CAAC;KAC3D;IAAC,OAAO,CAAC,EAAE;QACV,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,EAAE,OAAO,EAAE,oBAAoB,GAAG,CAAC,MAAM,CAAC,QAAQ,EAAE,EAAC,CAAC,CAAC;QAC5E,OAAO;KACR;IAED,MAAM,CAAC,IAAI,EAAE,YAAY,CAAC,GAAG,MAAM,OAAO,CAAC,GAAG,CAAC,CAAC,cAAO,EAAE,EAAE,sBAAe,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC;IACvF,MAAM,QAAQ,GAAG,IAAI,CAAC,MAAM,CAAC,CAAC,GAAgB,EAAE,EAAoB,EAAE,EAAE;QACtE,GAAG,CAAC,EAAE,CAAC,QAAQ,CAAC,CAAC,IAAI,CAAC,IAAI,sBAAe,CAAC,EAAE,EAAE,YAAY,CAAC,CAAC,CAAA;QAC5D,OAAO,GAAG,CAAC;IACb,CAAC,EAAE,kBAAW,EAAE,CAAC,CAAC;IAClB,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;AACjC,CAAC,CAAA,CAAC,CAAC;AAEH,kBAAe,MAAM,CAAC","sourcesContent":["import { Router } from 'express';\nimport { getMenu, MenuItemDocument } from \"../datasource/menu\";\nimport { MenuPayload, MenuItemPayload } from \"../domain/menu\";\nimport { Currency } from \"../domain/currency\";\nimport { getExchangeRate } from \"../datasource/rate\";\n\nconst router = Router();\nrouter.get('/', async (req, res) => {\n  let currency: Currency;\n  try {\n    currency = req.query.currency as Currency || Currency.EUR;\n  } catch (e) {\n    res.status(400).json({ message: `Unknown currency ${req.params.currency}`});\n    return;\n  }\n\n  const [menu, exchangeRate] = await Promise.all([getMenu(), getExchangeRate(currency)]);\n  const response = menu.reduce((acc: MenuPayload, el: MenuItemDocument) => {\n    acc[el.category].push(new MenuItemPayload(el, exchangeRate))\n    return acc;\n  }, MenuPayload());\n  res.status(200).json(response);\n});\n\nexport default router;\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"40d418d424fa69290857df949096c26234ff754a","contentHash":"508d320170d7be906a78b08fce35df95ec8855c4396e278378a59a6d00a0695f"},"/Users/spyros/workspace/desquared-online-delivery/src/datasource/menu.ts":{"path":"/Users/spyros/workspace/desquared-online-delivery/src/datasource/menu.ts","statementMap":{"0":{"start":{"line":2,"column":16},"end":{"line":10,"column":1}},"1":{"start":{"line":3,"column":28},"end":{"line":3,"column":110}},"2":{"start":{"line":3,"column":91},"end":{"line":3,"column":106}},"3":{"start":{"line":4,"column":4},"end":{"line":9,"column":7}},"4":{"start":{"line":5,"column":36},"end":{"line":5,"column":97}},"5":{"start":{"line":5,"column":42},"end":{"line":5,"column":70}},"6":{"start":{"line":5,"column":85},"end":{"line":5,"column":95}},"7":{"start":{"line":6,"column":35},"end":{"line":6,"column":100}},"8":{"start":{"line":6,"column":41},"end":{"line":6,"column":73}},"9":{"start":{"line":6,"column":88},"end":{"line":6,"column":98}},"10":{"start":{"line":7,"column":32},"end":{"line":7,"column":116}},"11":{"start":{"line":8,"column":8},"end":{"line":8,"column":78}},"12":{"start":{"line":11,"column":0},"end":{"line":11,"column":62}},"13":{"start":{"line":12,"column":19},"end":{"line":12,"column":38}},"14":{"start":{"line":13,"column":15},"end":{"line":13,"column":40}},"15":{"start":{"line":14,"column":23},"end":{"line":19,"column":2}},"16":{"start":{"line":20,"column":0},"end":{"line":20,"column":69}},"17":{"start":{"line":22,"column":4},"end":{"line":24,"column":7}},"18":{"start":{"line":23,"column":8},"end":{"line":23,"column":51}},"19":{"start":{"line":26,"column":0},"end":{"line":26,"column":26}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":2,"column":44},"end":{"line":2,"column":45}},"loc":{"start":{"line":2,"column":89},"end":{"line":10,"column":1}},"line":2},"1":{"name":"adopt","decl":{"start":{"line":3,"column":13},"end":{"line":3,"column":18}},"loc":{"start":{"line":3,"column":26},"end":{"line":3,"column":112}},"line":3},"2":{"name":"(anonymous_2)","decl":{"start":{"line":3,"column":70},"end":{"line":3,"column":71}},"loc":{"start":{"line":3,"column":89},"end":{"line":3,"column":108}},"line":3},"3":{"name":"(anonymous_3)","decl":{"start":{"line":4,"column":36},"end":{"line":4,"column":37}},"loc":{"start":{"line":4,"column":63},"end":{"line":9,"column":5}},"line":4},"4":{"name":"fulfilled","decl":{"start":{"line":5,"column":17},"end":{"line":5,"column":26}},"loc":{"start":{"line":5,"column":34},"end":{"line":5,"column":99}},"line":5},"5":{"name":"rejected","decl":{"start":{"line":6,"column":17},"end":{"line":6,"column":25}},"loc":{"start":{"line":6,"column":33},"end":{"line":6,"column":102}},"line":6},"6":{"name":"step","decl":{"start":{"line":7,"column":17},"end":{"line":7,"column":21}},"loc":{"start":{"line":7,"column":30},"end":{"line":7,"column":118}},"line":7},"7":{"name":"getMenu","decl":{"start":{"line":21,"column":9},"end":{"line":21,"column":16}},"loc":{"start":{"line":21,"column":19},"end":{"line":25,"column":1}},"line":21},"8":{"name":"(anonymous_8)","decl":{"start":{"line":22,"column":43},"end":{"line":22,"column":44}},"loc":{"start":{"line":22,"column":56},"end":{"line":24,"column":5}},"line":22}},"branchMap":{"0":{"loc":{"start":{"line":2,"column":16},"end":{"line":10,"column":1}},"type":"binary-expr","locations":[{"start":{"line":2,"column":17},"end":{"line":2,"column":21}},{"start":{"line":2,"column":25},"end":{"line":2,"column":39}},{"start":{"line":2,"column":44},"end":{"line":10,"column":1}}],"line":2},"1":{"loc":{"start":{"line":3,"column":35},"end":{"line":3,"column":109}},"type":"cond-expr","locations":[{"start":{"line":3,"column":56},"end":{"line":3,"column":61}},{"start":{"line":3,"column":64},"end":{"line":3,"column":109}}],"line":3},"2":{"loc":{"start":{"line":4,"column":16},"end":{"line":4,"column":34}},"type":"binary-expr","locations":[{"start":{"line":4,"column":16},"end":{"line":4,"column":17}},{"start":{"line":4,"column":22},"end":{"line":4,"column":33}}],"line":4},"3":{"loc":{"start":{"line":7,"column":32},"end":{"line":7,"column":115}},"type":"cond-expr","locations":[{"start":{"line":7,"column":46},"end":{"line":7,"column":67}},{"start":{"line":7,"column":70},"end":{"line":7,"column":115}}],"line":7},"4":{"loc":{"start":{"line":8,"column":51},"end":{"line":8,"column":67}},"type":"binary-expr","locations":[{"start":{"line":8,"column":51},"end":{"line":8,"column":61}},{"start":{"line":8,"column":65},"end":{"line":8,"column":67}}],"line":8}},"s":{"0":1,"1":0,"2":0,"3":3,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":3,"11":3,"12":1,"13":1,"14":1,"15":1,"16":1,"17":3,"18":3,"19":1},"f":{"0":3,"1":0,"2":0,"3":3,"4":0,"5":0,"6":3,"7":3,"8":3},"b":{"0":[1,1,1],"1":[0,0],"2":[3,3],"3":[3,0],"4":[3,3]},"inputSourceMap":{"version":3,"file":"/Users/spyros/workspace/desquared-online-delivery/src/datasource/menu.ts","sources":["/Users/spyros/workspace/desquared-online-delivery/src/datasource/menu.ts"],"names":[],"mappings":";;;;;;;;;;;AAAA,uCAA0D;AAC1D,yCAAkD;AAElD,MAAM,cAAc,GAAG,IAAI,iBAAM,CAAC;IAC9B,IAAI,EAAE,EAAE,IAAI,EAAE,MAAM,EAAE,QAAQ,EAAE,IAAI,EAAE;IACtC,WAAW,EAAE,EAAE,IAAI,EAAE,MAAM,EAAE;IAC7B,eAAe,EAAE,EAAE,IAAI,EAAE,MAAM,EAAE,GAAG,EAAE,CAAC,EAAE,QAAQ,EAAE,IAAI,EAAE;IACzD,QAAQ,EAAE,EAAE,IAAI,EAAE,MAAM,EAAE,IAAI,EAAE,MAAM,CAAC,MAAM,CAAC,uBAAgB,CAAC,EAAE,QAAQ,EAAE,IAAI,EAAE;CACpF,CAAC,CAAA;AASW,QAAA,aAAa,GAAgC,gBAAK,CAAmB,UAAU,EAAE,cAAc,CAAC,CAAA;AAE7G,SAAsB,OAAO;;QACzB,OAAO,qBAAa,CAAC,IAAI,EAAE,CAAC,IAAI,EAAE,CAAC;IACvC,CAAC;CAAA;AAFD,0BAEC","sourcesContent":["import { Document, model, Model, Schema } from \"mongoose\";\nimport { MenuItemCategory } from \"../domain/menu\";\n\nconst menuItemSchema = new Schema({\n    name: { type: String, required: true },\n    description: { type: String },\n    price_eur_cents: { type: Number, min: 1, required: true },\n    category: { type: String, enum: Object.values(MenuItemCategory), required: true }\n})\n\nexport type MenuItemDocument = Document & {\n    name: string;\n    description?: string;\n    price_eur_cents: number;\n    category: MenuItemCategory;\n}\n\nexport const MongoMenuItem: Model<MenuItemDocument, {}> = model<MenuItemDocument>('MenuItem', menuItemSchema)\n\nexport async function getMenu(): Promise<Array<MenuItemDocument>> {\n    return MongoMenuItem.find().lean();\n}\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"11049232ff553eb3607c52db7a6327494c9e24f8","contentHash":"3a2c5dd81827ceef5a46114b25f79f91c2e60b652a3bf8007be812ca1979525a"},"/Users/spyros/workspace/desquared-online-delivery/src/domain/menu.ts":{"path":"/Users/spyros/workspace/desquared-online-delivery/src/domain/menu.ts","statementMap":{"0":{"start":{"line":6,"column":0},"end":{"line":6,"column":62}},"1":{"start":{"line":7,"column":0},"end":{"line":12,"column":3}},"2":{"start":{"line":7,"column":29},"end":{"line":12,"column":1}},"3":{"start":{"line":15,"column":8},"end":{"line":15,"column":26}},"4":{"start":{"line":16,"column":8},"end":{"line":16,"column":29}},"5":{"start":{"line":17,"column":8},"end":{"line":17,"column":43}},"6":{"start":{"line":18,"column":8},"end":{"line":18,"column":56}},"7":{"start":{"line":21,"column":0},"end":{"line":21,"column":42}},"8":{"start":{"line":23,"column":0},"end":{"line":28,"column":83}},"9":{"start":{"line":24,"column":4},"end":{"line":24,"column":49}},"10":{"start":{"line":25,"column":4},"end":{"line":25,"column":41}},"11":{"start":{"line":26,"column":4},"end":{"line":26,"column":39}},"12":{"start":{"line":27,"column":4},"end":{"line":27,"column":41}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":22},"end":{"line":7,"column":23}},"loc":{"start":{"line":7,"column":29},"end":{"line":12,"column":1}},"line":7},"1":{"name":"(anonymous_1)","decl":{"start":{"line":14,"column":4},"end":{"line":14,"column":5}},"loc":{"start":{"line":14,"column":39},"end":{"line":19,"column":5}},"line":14},"2":{"name":"(anonymous_2)","decl":{"start":{"line":23,"column":1},"end":{"line":23,"column":2}},"loc":{"start":{"line":23,"column":29},"end":{"line":28,"column":1}},"line":23}},"branchMap":{"0":{"loc":{"start":{"line":14,"column":21},"end":{"line":14,"column":37}},"type":"default-arg","locations":[{"start":{"line":14,"column":36},"end":{"line":14,"column":37}}],"line":14},"1":{"loc":{"start":{"line":28,"column":22},"end":{"line":28,"column":81}},"type":"binary-expr","locations":[{"start":{"line":28,"column":22},"end":{"line":28,"column":46}},{"start":{"line":28,"column":51},"end":{"line":28,"column":80}}],"line":28}},"s":{"0":1,"1":1,"2":3,"3":6,"4":6,"5":6,"6":6,"7":1,"8":1,"9":1,"10":1,"11":1,"12":1},"f":{"0":3,"1":6,"2":1},"b":{"0":[0],"1":[1,1]},"inputSourceMap":{"version":3,"file":"/Users/spyros/workspace/desquared-online-delivery/src/domain/menu.ts","sources":["/Users/spyros/workspace/desquared-online-delivery/src/domain/menu.ts"],"names":[],"mappings":";AAAA;;;EAGE;;AAWW,QAAA,WAAW,GAAsB,GAAG,EAAE,CAAC,CAAC;IACjD,UAAU,EAAE,EAAE;IACd,MAAM,EAAE,EAAE;IACV,KAAK,EAAE,EAAE;IACT,MAAM,EAAE,EAAE;CACG,CAAA,CAAA;AAEjB,MAAa,eAAe;IAMxB,YAAY,GAAqB,EAAE,eAAuB,CAAC;QACvD,IAAI,CAAC,EAAE,GAAG,GAAG,CAAC,GAAG,CAAC;QAClB,IAAI,CAAC,IAAI,GAAG,GAAG,CAAC,IAAI,CAAC;QACrB,IAAI,CAAC,WAAW,GAAG,GAAG,CAAC,WAAW,CAAC;QACnC,IAAI,CAAC,KAAK,GAAG,GAAG,CAAC,eAAe,GAAG,YAAY,CAAC;IACpD,CAAC;CACJ;AAZD,0CAYC;AAED,IAAY,gBAKX;AALD,WAAY,gBAAgB;IACxB,4CAAwB,CAAA;IACxB,oCAAgB,CAAA;IAChB,kCAAc,CAAA;IACd,oCAAgB,CAAA;AACpB,CAAC,EALW,gBAAgB,GAAhB,wBAAgB,KAAhB,wBAAgB,QAK3B","sourcesContent":["/*\n NOTE : in a real world scenario the categories would be a separate configurable\n entity in the database - omitting now for brevity\n*/\n\nimport { MenuItemDocument } from \"../datasource/menu\";\n\nexport interface MenuPayload {\n    appetizers: Array<MenuItemPayload>;\n    salads: Array<MenuItemPayload>;\n    mains: Array<MenuItemPayload>;\n    drinks: Array<MenuItemPayload>;\n}\n\nexport const MenuPayload: () => MenuPayload = () => ({\n    appetizers: [],\n    salads: [],\n    mains: [],\n    drinks: []\n} as MenuPayload)\n\nexport class MenuItemPayload {\n    id: string;\n    name: string;\n    description: string;\n    price: number;\n\n    constructor(doc: MenuItemDocument, exchangeRate: number = 1) {\n        this.id = doc._id;\n        this.name = doc.name;\n        this.description = doc.description;\n        this.price = doc.price_eur_cents * exchangeRate;\n    }\n}\n\nexport enum MenuItemCategory {\n    Appetizer = \"appetizers\",\n    Salad = \"salads\",\n    Main = \"mains\",\n    Drink = \"drinks\"\n}\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"1d952a6f3ba5d85c60f0bb9f1d66af90c3fbfbe9","contentHash":"1bb0d1539b6bb745775fe9c922731b57876650d1cbffbdbada2e64dad6ce8375"},"/Users/spyros/workspace/desquared-online-delivery/src/domain/currency.ts":{"path":"/Users/spyros/workspace/desquared-online-delivery/src/domain/currency.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":4,"column":0},"end":{"line":9,"column":59}},"2":{"start":{"line":5,"column":4},"end":{"line":5,"column":28}},"3":{"start":{"line":6,"column":4},"end":{"line":6,"column":28}},"4":{"start":{"line":7,"column":4},"end":{"line":7,"column":28}},"5":{"start":{"line":8,"column":4},"end":{"line":8,"column":28}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":4,"column":1},"end":{"line":4,"column":2}},"loc":{"start":{"line":4,"column":21},"end":{"line":9,"column":1}},"line":4}},"branchMap":{"0":{"loc":{"start":{"line":9,"column":14},"end":{"line":9,"column":57}},"type":"binary-expr","locations":[{"start":{"line":9,"column":14},"end":{"line":9,"column":30}},{"start":{"line":9,"column":35},"end":{"line":9,"column":56}}],"line":9}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1},"f":{"0":1},"b":{"0":[1,1]},"inputSourceMap":{"version":3,"file":"/Users/spyros/workspace/desquared-online-delivery/src/domain/currency.ts","sources":["/Users/spyros/workspace/desquared-online-delivery/src/domain/currency.ts"],"names":[],"mappings":";;AAAA,IAAY,QAKX;AALD,WAAY,QAAQ;IAChB,uBAAW,CAAA;IACX,uBAAW,CAAA;IACX,uBAAW,CAAA;IACX,uBAAW,CAAA;AACf,CAAC,EALW,QAAQ,GAAR,gBAAQ,KAAR,gBAAQ,QAKnB","sourcesContent":["export enum Currency {\n    EUR = \"EUR\",\n    USD = \"USD\",\n    GBP = \"GBP\",\n    CHF = \"CHF\"\n}"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"d724ecd060f2496359528ca7d0c6524cdc3f20e9","contentHash":"398292b8f17613bf127f7616da906958ea9d0609b49c08e91b30fe21f193a419"},"/Users/spyros/workspace/desquared-online-delivery/src/datasource/rate.ts":{"path":"/Users/spyros/workspace/desquared-online-delivery/src/datasource/rate.ts","statementMap":{"0":{"start":{"line":2,"column":16},"end":{"line":10,"column":1}},"1":{"start":{"line":3,"column":28},"end":{"line":3,"column":110}},"2":{"start":{"line":3,"column":91},"end":{"line":3,"column":106}},"3":{"start":{"line":4,"column":4},"end":{"line":9,"column":7}},"4":{"start":{"line":5,"column":36},"end":{"line":5,"column":97}},"5":{"start":{"line":5,"column":42},"end":{"line":5,"column":70}},"6":{"start":{"line":5,"column":85},"end":{"line":5,"column":95}},"7":{"start":{"line":6,"column":35},"end":{"line":6,"column":100}},"8":{"start":{"line":6,"column":41},"end":{"line":6,"column":73}},"9":{"start":{"line":6,"column":88},"end":{"line":6,"column":98}},"10":{"start":{"line":7,"column":32},"end":{"line":7,"column":116}},"11":{"start":{"line":8,"column":8},"end":{"line":8,"column":78}},"12":{"start":{"line":11,"column":0},"end":{"line":11,"column":62}},"13":{"start":{"line":12,"column":19},"end":{"line":12,"column":38}},"14":{"start":{"line":13,"column":14},"end":{"line":13,"column":34}},"15":{"start":{"line":14,"column":19},"end":{"line":14,"column":48}},"16":{"start":{"line":15,"column":15},"end":{"line":15,"column":32}},"17":{"start":{"line":16,"column":19},"end":{"line":21,"column":2}},"18":{"start":{"line":22,"column":0},"end":{"line":22,"column":73}},"19":{"start":{"line":23,"column":22},"end":{"line":26,"column":2}},"20":{"start":{"line":28,"column":4},"end":{"line":48,"column":7}},"21":{"start":{"line":29,"column":8},"end":{"line":31,"column":9}},"22":{"start":{"line":30,"column":12},"end":{"line":30,"column":21}},"23":{"start":{"line":32,"column":23},"end":{"line":32,"column":57}},"24":{"start":{"line":33,"column":8},"end":{"line":35,"column":9}},"25":{"start":{"line":34,"column":12},"end":{"line":34,"column":26}},"26":{"start":{"line":36,"column":30},"end":{"line":40,"column":38}},"27":{"start":{"line":41,"column":8},"end":{"line":43,"column":9}},"28":{"start":{"line":42,"column":12},"end":{"line":42,"column":56}},"29":{"start":{"line":44,"column":31},"end":{"line":44,"column":47}},"30":{"start":{"line":45,"column":20},"end":{"line":45,"column":71}},"31":{"start":{"line":46,"column":8},"end":{"line":46,"column":54}},"32":{"start":{"line":47,"column":8},"end":{"line":47,"column":20}},"33":{"start":{"line":50,"column":0},"end":{"line":50,"column":42}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":2,"column":44},"end":{"line":2,"column":45}},"loc":{"start":{"line":2,"column":89},"end":{"line":10,"column":1}},"line":2},"1":{"name":"adopt","decl":{"start":{"line":3,"column":13},"end":{"line":3,"column":18}},"loc":{"start":{"line":3,"column":26},"end":{"line":3,"column":112}},"line":3},"2":{"name":"(anonymous_2)","decl":{"start":{"line":3,"column":70},"end":{"line":3,"column":71}},"loc":{"start":{"line":3,"column":89},"end":{"line":3,"column":108}},"line":3},"3":{"name":"(anonymous_3)","decl":{"start":{"line":4,"column":36},"end":{"line":4,"column":37}},"loc":{"start":{"line":4,"column":63},"end":{"line":9,"column":5}},"line":4},"4":{"name":"fulfilled","decl":{"start":{"line":5,"column":17},"end":{"line":5,"column":26}},"loc":{"start":{"line":5,"column":34},"end":{"line":5,"column":99}},"line":5},"5":{"name":"rejected","decl":{"start":{"line":6,"column":17},"end":{"line":6,"column":25}},"loc":{"start":{"line":6,"column":33},"end":{"line":6,"column":102}},"line":6},"6":{"name":"step","decl":{"start":{"line":7,"column":17},"end":{"line":7,"column":21}},"loc":{"start":{"line":7,"column":30},"end":{"line":7,"column":118}},"line":7},"7":{"name":"getExchangeRate","decl":{"start":{"line":27,"column":9},"end":{"line":27,"column":24}},"loc":{"start":{"line":27,"column":61},"end":{"line":49,"column":1}},"line":27},"8":{"name":"(anonymous_8)","decl":{"start":{"line":28,"column":43},"end":{"line":28,"column":44}},"loc":{"start":{"line":28,"column":56},"end":{"line":48,"column":5}},"line":28}},"branchMap":{"0":{"loc":{"start":{"line":2,"column":16},"end":{"line":10,"column":1}},"type":"binary-expr","locations":[{"start":{"line":2,"column":17},"end":{"line":2,"column":21}},{"start":{"line":2,"column":25},"end":{"line":2,"column":39}},{"start":{"line":2,"column":44},"end":{"line":10,"column":1}}],"line":2},"1":{"loc":{"start":{"line":3,"column":35},"end":{"line":3,"column":109}},"type":"cond-expr","locations":[{"start":{"line":3,"column":56},"end":{"line":3,"column":61}},{"start":{"line":3,"column":64},"end":{"line":3,"column":109}}],"line":3},"2":{"loc":{"start":{"line":4,"column":16},"end":{"line":4,"column":34}},"type":"binary-expr","locations":[{"start":{"line":4,"column":16},"end":{"line":4,"column":17}},{"start":{"line":4,"column":22},"end":{"line":4,"column":33}}],"line":4},"3":{"loc":{"start":{"line":7,"column":32},"end":{"line":7,"column":115}},"type":"cond-expr","locations":[{"start":{"line":7,"column":46},"end":{"line":7,"column":67}},{"start":{"line":7,"column":70},"end":{"line":7,"column":115}}],"line":7},"4":{"loc":{"start":{"line":8,"column":51},"end":{"line":8,"column":67}},"type":"binary-expr","locations":[{"start":{"line":8,"column":51},"end":{"line":8,"column":61}},{"start":{"line":8,"column":65},"end":{"line":8,"column":67}}],"line":8},"5":{"loc":{"start":{"line":27,"column":29},"end":{"line":27,"column":59}},"type":"default-arg","locations":[{"start":{"line":27,"column":36},"end":{"line":27,"column":59}}],"line":27},"6":{"loc":{"start":{"line":29,"column":8},"end":{"line":31,"column":9}},"type":"if","locations":[{"start":{"line":29,"column":8},"end":{"line":31,"column":9}},{"start":{"line":29,"column":8},"end":{"line":31,"column":9}}],"line":29},"7":{"loc":{"start":{"line":33,"column":8},"end":{"line":35,"column":9}},"type":"if","locations":[{"start":{"line":33,"column":8},"end":{"line":35,"column":9}},{"start":{"line":33,"column":8},"end":{"line":35,"column":9}}],"line":33},"8":{"loc":{"start":{"line":41,"column":8},"end":{"line":43,"column":9}},"type":"if","locations":[{"start":{"line":41,"column":8},"end":{"line":43,"column":9}},{"start":{"line":41,"column":8},"end":{"line":43,"column":9}}],"line":41}},"s":{"0":1,"1":1,"2":1,"3":3,"4":1,"5":1,"6":0,"7":0,"8":0,"9":0,"10":4,"11":3,"12":1,"13":1,"14":1,"15":1,"16":1,"17":1,"18":1,"19":1,"20":3,"21":3,"22":2,"23":1,"24":1,"25":0,"26":1,"27":1,"28":0,"29":1,"30":1,"31":1,"32":1,"33":1},"f":{"0":3,"1":1,"2":1,"3":3,"4":1,"5":0,"6":4,"7":3,"8":3},"b":{"0":[1,1,1],"1":[0,1],"2":[3,3],"3":[3,1],"4":[3,3],"5":[3],"6":[2,1],"7":[0,1],"8":[0,1]},"inputSourceMap":{"version":3,"file":"/Users/spyros/workspace/desquared-online-delivery/src/datasource/rate.ts","sources":["/Users/spyros/workspace/desquared-online-delivery/src/datasource/rate.ts"],"names":[],"mappings":";;;;;;;;;;;AAAA,uCAA0D;AAC1D,mCAAmC;AACnC,iDAA8C;AAC9C,iCAAiC;AAEjC,MAAM,UAAU,GAAG,IAAI,iBAAM,CAAC;IAC1B,IAAI,EAAE,EAAE,IAAI,EAAE,IAAI,EAAE;IACpB,IAAI,EAAE,EAAE,IAAI,EAAE,MAAM,EAAE,IAAI,EAAE,MAAM,CAAC,MAAM,CAAC,mBAAQ,CAAC,EAAE;IACrD,EAAE,EAAE,EAAE,IAAI,EAAE,MAAM,EAAE,IAAI,EAAE,MAAM,CAAC,MAAM,CAAC,mBAAQ,CAAC,EAAE;IACnD,IAAI,EAAE,EAAE,IAAI,EAAE,MAAM,EAAE;CACzB,CAAC,CAAC;AASU,QAAA,iBAAiB,GAAoC,gBAAK,CAAuB,cAAc,EAAE,UAAU,CAAC,CAAC;AAE1H,MAAM,aAAa,GAAG,IAAI,KAAK,CAAiB;IAC5C,GAAG,EAAE,MAAM,CAAC,IAAI,CAAC,mBAAQ,CAAC,CAAC,MAAM,GAAG,CAAC;IACrC,MAAM,EAAE,EAAE,GAAG,EAAE,GAAG,EAAE;CACvB,CAAC,CAAC;AAEH,SAAsB,eAAe,CAAC,EAAY,EAAE,OAAiB,mBAAQ,CAAC,GAAG;;QAC7E,IAAI,IAAI,KAAK,EAAE,EAAE;YAAE,OAAO,CAAC,CAAC;SAAE;QAE9B,MAAM,MAAM,GAAG,aAAa,CAAC,GAAG,CAAC,GAAG,IAAI,IAAI,EAAE,EAAE,CAAC,CAAA;QACjD,IAAI,MAAM,EAAE;YAAE,OAAO,MAAM,CAAC;SAAE;QAE9B,MAAM,aAAa,GAAG,MAAM,yBAAiB,CAAC,IAAI,CAAC;YAC/C,IAAI,EAAE,IAAI;YACV,EAAE,EAAE,EAAE;YACN,IAAI,EAAE,EAAE,IAAI,EAAE,MAAM,EAAE,CAAC,QAAQ,CAAC,CAAC,EAAE,KAAK,CAAC,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC,MAAM,EAAE,EAAE;SACtE,CAAC,CAAC,IAAI,CAAC,EAAE,IAAI,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;QAE/B,IAAI,CAAC,aAAa,CAAC,MAAM,EAAE;YACvB,MAAM,KAAK,CAAC,8BAA8B,CAAC,CAAC;SAC/C;QACD,MAAM,EAAE,IAAI,EAAE,IAAI,EAAE,GAAG,aAAa,CAAC,CAAC,CAAC,CAAA;QACvC,MAAM,GAAG,GAAG,MAAM,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,MAAM,EAAE,CAAC,KAAK,CAAC,KAAK,CAAC,EAAE,SAAS,CAAC,CAAC;QAChE,aAAa,CAAC,GAAG,CAAC,GAAG,IAAI,IAAI,EAAE,EAAE,EAAE,IAAI,EAAE,GAAG,CAAC,CAAC;QAE9C,OAAO,IAAI,CAAC;IAChB,CAAC;CAAA;AApBD,0CAoBC","sourcesContent":["import { Document, model, Model, Schema } from \"mongoose\";\nimport * as Cache from \"lru-cache\";\nimport { Currency } from \"../domain/currency\";\nimport * as moment from \"moment\";\n\nconst rateSchema = new Schema({\n    date: { type: Date },\n    from: { type: String, enum: Object.values(Currency) },\n    to: { type: String, enum: Object.values(Currency) },\n    rate: { type: Number }\n});\n\nexport type CurrencyRateDocument = Document & {\n    date: Date;\n    from: Currency;\n    to: Currency;\n    rate: number;\n}\n\nexport const MongoCurrencyRate: Model<CurrencyRateDocument, {}> = model<CurrencyRateDocument>('CurrencyRate', rateSchema);\n\nconst exchangeCache = new Cache<string, number>({\n    max: Object.keys(Currency).length * 2,\n    maxAge: 24 * 60 * 60\n});\n\nexport async function getExchangeRate(to: Currency, from: Currency = Currency.EUR): Promise<number> {\n    if (from === to) { return 1; }\n\n    const cached = exchangeCache.get(`${from}-${to}`)\n    if (cached) { return cached; }\n\n    const resolvedRates = await MongoCurrencyRate.find({\n        from: from,\n        to: to,\n        date: { $gte: moment().subtract(1, 'day').startOf('day').toDate() }\n    }).sort({ date: -1 }).limit(1);\n\n    if (!resolvedRates.length) {\n        throw Error('could not find exchange rate');\n    }\n    const { rate, date } = resolvedRates[0]\n    const ttl = moment(date).diff(moment().endOf('day'), 'seconds');\n    exchangeCache.set(`${from}-${to}`, rate, ttl);\n\n    return rate;\n}\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"8c85c95a0351259d67239da92cd87deda453071c","contentHash":"2144b6e9e15a63f0735c415b838bc43e7633fc62379718dd599b536c75b54266"},"/Users/spyros/workspace/desquared-online-delivery/src/handlers/cart.ts":{"path":"/Users/spyros/workspace/desquared-online-delivery/src/handlers/cart.ts","statementMap":{"0":{"start":{"line":2,"column":16},"end":{"line":10,"column":1}},"1":{"start":{"line":3,"column":28},"end":{"line":3,"column":110}},"2":{"start":{"line":3,"column":91},"end":{"line":3,"column":106}},"3":{"start":{"line":4,"column":4},"end":{"line":9,"column":7}},"4":{"start":{"line":5,"column":36},"end":{"line":5,"column":97}},"5":{"start":{"line":5,"column":42},"end":{"line":5,"column":70}},"6":{"start":{"line":5,"column":85},"end":{"line":5,"column":95}},"7":{"start":{"line":6,"column":35},"end":{"line":6,"column":100}},"8":{"start":{"line":6,"column":41},"end":{"line":6,"column":73}},"9":{"start":{"line":6,"column":88},"end":{"line":6,"column":98}},"10":{"start":{"line":7,"column":32},"end":{"line":7,"column":116}},"11":{"start":{"line":8,"column":8},"end":{"line":8,"column":78}},"12":{"start":{"line":11,"column":0},"end":{"line":11,"column":62}},"13":{"start":{"line":12,"column":18},"end":{"line":12,"column":36}},"14":{"start":{"line":13,"column":15},"end":{"line":13,"column":44}},"15":{"start":{"line":14,"column":15},"end":{"line":14,"column":40}},"16":{"start":{"line":15,"column":15},"end":{"line":15,"column":33}},"17":{"start":{"line":16,"column":0},"end":{"line":21,"column":4}},"18":{"start":{"line":16,"column":31},"end":{"line":21,"column":2}},"19":{"start":{"line":17,"column":17},"end":{"line":17,"column":42}},"20":{"start":{"line":18,"column":4},"end":{"line":20,"column":16}},"21":{"start":{"line":22,"column":0},"end":{"line":31,"column":4}},"22":{"start":{"line":22,"column":33},"end":{"line":31,"column":2}},"23":{"start":{"line":23,"column":4},"end":{"line":30,"column":5}},"24":{"start":{"line":24,"column":21},"end":{"line":24,"column":56}},"25":{"start":{"line":25,"column":25},"end":{"line":25,"column":53}},"26":{"start":{"line":26,"column":8},"end":{"line":26,"column":39}},"27":{"start":{"line":29,"column":8},"end":{"line":29,"column":31}},"28":{"start":{"line":32,"column":0},"end":{"line":32,"column":25}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":2,"column":44},"end":{"line":2,"column":45}},"loc":{"start":{"line":2,"column":89},"end":{"line":10,"column":1}},"line":2},"1":{"name":"adopt","decl":{"start":{"line":3,"column":13},"end":{"line":3,"column":18}},"loc":{"start":{"line":3,"column":26},"end":{"line":3,"column":112}},"line":3},"2":{"name":"(anonymous_2)","decl":{"start":{"line":3,"column":70},"end":{"line":3,"column":71}},"loc":{"start":{"line":3,"column":89},"end":{"line":3,"column":108}},"line":3},"3":{"name":"(anonymous_3)","decl":{"start":{"line":4,"column":36},"end":{"line":4,"column":37}},"loc":{"start":{"line":4,"column":63},"end":{"line":9,"column":5}},"line":4},"4":{"name":"fulfilled","decl":{"start":{"line":5,"column":17},"end":{"line":5,"column":26}},"loc":{"start":{"line":5,"column":34},"end":{"line":5,"column":99}},"line":5},"5":{"name":"rejected","decl":{"start":{"line":6,"column":17},"end":{"line":6,"column":25}},"loc":{"start":{"line":6,"column":33},"end":{"line":6,"column":102}},"line":6},"6":{"name":"step","decl":{"start":{"line":7,"column":17},"end":{"line":7,"column":21}},"loc":{"start":{"line":7,"column":30},"end":{"line":7,"column":118}},"line":7},"7":{"name":"(anonymous_7)","decl":{"start":{"line":16,"column":17},"end":{"line":16,"column":18}},"loc":{"start":{"line":16,"column":31},"end":{"line":21,"column":2}},"line":16},"8":{"name":"(anonymous_8)","decl":{"start":{"line":16,"column":65},"end":{"line":16,"column":66}},"loc":{"start":{"line":16,"column":78},"end":{"line":21,"column":1}},"line":16},"9":{"name":"(anonymous_9)","decl":{"start":{"line":22,"column":19},"end":{"line":22,"column":20}},"loc":{"start":{"line":22,"column":33},"end":{"line":31,"column":2}},"line":22},"10":{"name":"(anonymous_10)","decl":{"start":{"line":22,"column":67},"end":{"line":22,"column":68}},"loc":{"start":{"line":22,"column":80},"end":{"line":31,"column":1}},"line":22}},"branchMap":{"0":{"loc":{"start":{"line":2,"column":16},"end":{"line":10,"column":1}},"type":"binary-expr","locations":[{"start":{"line":2,"column":17},"end":{"line":2,"column":21}},{"start":{"line":2,"column":25},"end":{"line":2,"column":39}},{"start":{"line":2,"column":44},"end":{"line":10,"column":1}}],"line":2},"1":{"loc":{"start":{"line":3,"column":35},"end":{"line":3,"column":109}},"type":"cond-expr","locations":[{"start":{"line":3,"column":56},"end":{"line":3,"column":61}},{"start":{"line":3,"column":64},"end":{"line":3,"column":109}}],"line":3},"2":{"loc":{"start":{"line":4,"column":16},"end":{"line":4,"column":34}},"type":"binary-expr","locations":[{"start":{"line":4,"column":16},"end":{"line":4,"column":17}},{"start":{"line":4,"column":22},"end":{"line":4,"column":33}}],"line":4},"3":{"loc":{"start":{"line":7,"column":32},"end":{"line":7,"column":115}},"type":"cond-expr","locations":[{"start":{"line":7,"column":46},"end":{"line":7,"column":67}},{"start":{"line":7,"column":70},"end":{"line":7,"column":115}}],"line":7},"4":{"loc":{"start":{"line":8,"column":51},"end":{"line":8,"column":67}},"type":"binary-expr","locations":[{"start":{"line":8,"column":51},"end":{"line":8,"column":61}},{"start":{"line":8,"column":65},"end":{"line":8,"column":67}}],"line":8}},"s":{"0":1,"1":3,"2":0,"3":3,"4":2,"5":2,"6":0,"7":1,"8":1,"9":0,"10":6,"11":3,"12":1,"13":1,"14":1,"15":1,"16":1,"17":1,"18":1,"19":1,"20":1,"21":1,"22":2,"23":2,"24":2,"25":1,"26":1,"27":1,"28":1},"f":{"0":3,"1":3,"2":0,"3":3,"4":2,"5":1,"6":6,"7":1,"8":1,"9":2,"10":2},"b":{"0":[1,1,1],"1":[3,0],"2":[3,3],"3":[3,3],"4":[3,3]},"inputSourceMap":{"version":3,"file":"/Users/spyros/workspace/desquared-online-delivery/src/handlers/cart.ts","sources":["/Users/spyros/workspace/desquared-online-delivery/src/handlers/cart.ts"],"names":[],"mappings":";;;;;;;;;;;AAAA,qCAAiC;AACjC,6CAAyD;AACzD,yCAA6C;AAE7C,MAAM,MAAM,GAAG,gBAAM,EAAE,CAAC;AAExB,MAAM,CAAC,IAAI,CAAC,GAAG,EAAE,CAAO,GAAG,EAAE,GAAG,EAAE,EAAE;IACjC,MAAM,IAAI,GAAG,MAAM,iBAAU,EAAE,CAAC;IAChC,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC;SACV,MAAM,CAAC,UAAU,EAAE,GAAG,GAAG,CAAC,WAAW,IAAI,IAAI,CAAC,GAAG,EAAE,CAAC;SACpD,IAAI,EAAE,CAAC;AACf,CAAC,CAAA,CAAC,CAAC;AAEH,MAAM,CAAC,GAAG,CAAC,MAAM,EAAE,CAAO,GAAG,EAAE,GAAG,EAAE,EAAE;IACnC,IAAI;QACD,MAAM,IAAI,GAAG,MAAM,cAAO,CAAC,GAAG,CAAC,MAAM,CAAC,EAAE,CAAC,CAAC;QAC1C,MAAM,QAAQ,GAAG,IAAI,kBAAW,CAAC,IAAI,CAAC,CAAC;QACvC,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;KACjC;IAAC,OAAO,CAAC,EAAE;QACT,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,EAAE,CAAA;KACxB;AACJ,CAAC,CAAA,CAAC,CAAC;AAEH,kBAAe,MAAM,CAAC","sourcesContent":["import { Router } from 'express';\nimport { createCart, getCart } from \"../datasource/cart\";\nimport { CartPayload } from \"../domain/cart\";\n\nconst router = Router();\n\nrouter.post('/', async (req, res) => {\n   const cart = await createCart();\n   res.status(201)\n       .header('Location', `${req.originalUrl}/${cart._id}`)\n       .send();\n});\n\nrouter.get('/:id', async (req, res) => {\n   try {\n      const cart = await getCart(req.params.id);\n      const response = new CartPayload(cart);\n      res.status(200).json(response);\n   } catch (e) {\n      res.status(404).send()\n   }\n});\n\nexport default router;"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"013e4c52dfb09119fa3c2a26841e91f05aa8b0fe","contentHash":"ae1c26fd2dcd6694f302968a19b988febe6ef02269e50667cd08f54932845b9c"},"/Users/spyros/workspace/desquared-online-delivery/src/domain/cart.ts":{"path":"/Users/spyros/workspace/desquared-online-delivery/src/domain/cart.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":5,"column":8},"end":{"line":5,"column":26}},"2":{"start":{"line":6,"column":8},"end":{"line":6,"column":66}},"3":{"start":{"line":6,"column":41},"end":{"line":6,"column":64}},"4":{"start":{"line":9,"column":0},"end":{"line":9,"column":34}},"5":{"start":{"line":12,"column":8},"end":{"line":12,"column":33}},"6":{"start":{"line":13,"column":8},"end":{"line":13,"column":37}},"7":{"start":{"line":14,"column":8},"end":{"line":14,"column":35}},"8":{"start":{"line":17,"column":0},"end":{"line":17,"column":42}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":4,"column":4},"end":{"line":4,"column":5}},"loc":{"start":{"line":4,"column":21},"end":{"line":7,"column":5}},"line":4},"1":{"name":"(anonymous_1)","decl":{"start":{"line":6,"column":35},"end":{"line":6,"column":36}},"loc":{"start":{"line":6,"column":41},"end":{"line":6,"column":64}},"line":6},"2":{"name":"(anonymous_2)","decl":{"start":{"line":11,"column":4},"end":{"line":11,"column":5}},"loc":{"start":{"line":11,"column":21},"end":{"line":15,"column":5}},"line":11}},"branchMap":{},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1},"f":{"0":1,"1":1,"2":1},"b":{},"inputSourceMap":{"version":3,"file":"/Users/spyros/workspace/desquared-online-delivery/src/domain/cart.ts","sources":["/Users/spyros/workspace/desquared-online-delivery/src/domain/cart.ts"],"names":[],"mappings":";;AAEA,MAAa,WAAW;IAIpB,YAAY,GAAiB;QACzB,IAAI,CAAC,EAAE,GAAG,GAAG,CAAC,GAAG,CAAA;QACjB,IAAI,CAAC,KAAK,GAAG,GAAG,CAAC,KAAK,CAAC,GAAG,CAAC,EAAE,CAAC,EAAE,CAAC,IAAI,eAAe,CAAC,EAAE,CAAC,CAAC,CAAA;IAC7D,CAAC;CACJ;AARD,kCAQC;AAED,MAAa,eAAe;IAKxB,YAAY,GAAqB;QAC7B,IAAI,CAAC,MAAM,GAAG,GAAG,CAAC,MAAM,CAAA;QACxB,IAAI,CAAC,QAAQ,GAAG,GAAG,CAAC,QAAQ,CAAC;QAC7B,IAAI,CAAC,OAAO,GAAG,GAAG,CAAC,OAAO,CAAC;IAC/B,CAAC;CACJ;AAVD,0CAUC","sourcesContent":["import { CartDocument, CartItemDocument } from \"../datasource/cart\";\n\nexport class CartPayload {\n    id: string;\n    items: Array<CartItemPayload>;\n\n    constructor(doc: CartDocument) {\n        this.id = doc._id\n        this.items = doc.items.map(el => new CartItemPayload(el))\n    }\n}\n\nexport class CartItemPayload {\n    itemId: string;\n    quantity: number;\n    comment: string;\n\n    constructor(doc: CartItemDocument) {\n        this.itemId = doc.itemId\n        this.quantity = doc.quantity;\n        this.comment = doc.comment;\n    }\n}"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"869a20738e110544eaa06f6516442fac4dabd2e5","contentHash":"9fe211bd94d43cd528acc81a588f39a2d7f478041527ba652e7db030478c5d12"}}